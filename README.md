# 24h-raspberry-live-on-bilibili
[![All Contributors](https://img.shields.io/badge/all_contributors-7-orange.svg?style=flat-square)](#contributors)

æ ‘è“æ´¾é©±åŠ¨çš„bç«™ç›´æ’­ç‚¹æ’­å°

demo:[http://live.bilibili.com/16703](http://live.bilibili.com/16703)

![](https://github.com/chenxuuu/24h-raspberry-live-on-bilibili/raw/master/demo.jpg)

æ³¨æ„è¿™ä¸ªæ˜¯æ–°é¡¹ç›®ï¼ŒæŸ¥çœ‹æ—§ç‰ˆçš„ä»£ç è¯·æ‰“å¼€â€œoldâ€åˆ†æ”¯æŸ¥çœ‹ï¼ˆæ—§ç‰ˆä¸ºç½‘é¡µç‚¹æ­Œç‰ˆï¼‰

æœ¬é¡¹ç›®æœ‰ä¸¤ä¸ªé“¾æ¥ï¼š

GitHubï¼š[https://github.com/chenxuuu/24h-raspberry-live-on-bilibili.git](https://github.com/chenxuuu/24h-raspberry-live-on-bilibili.git)

git.oscï¼š[https://gitee.com/Young_For_You/24h-raspberry-live-on-bilibili.git](https://gitee.com/Young_For_You/24h-raspberry-live-on-bilibili.git)

----

### åŒæ—¶ä¹Ÿå¯ä»¥å»ç”¨smileccå¤§ä½¬é‡æ„çš„ç‰ˆæœ¬ï¼š

[blive-raspberryï¼ˆhttps://github.com/smilecc/blive-raspberryï¼‰](https://github.com/smilecc/blive-raspberry)

-------

æœ¬é¡¹ç›®åŸºæœ¬ç¼–å†™å®Œæ¯•ï¼Œå·²ç»æœ‰çš„åŠŸèƒ½ä¸ºï¼š

- å¼¹å¹•ç‚¹æ­Œ
- å¼¹å¹•ç‚¹MV
- å¼¹å¹•åé¦ˆï¼ˆå‘é€å¼¹å¹•ï¼‰
- æ—§ç‰ˆå®ç°çš„è§†é¢‘æ¨æµåŠŸèƒ½
- è‡ªå®šä¹‰ä»‹ç»å­—å¹•
- æ­Œè¯æ»šåŠ¨æ˜¾ç¤ºï¼ŒåŒæ—¶æ»šåŠ¨æ˜¾ç¤ºç¿»è¯‘æ­Œè¯
- åˆ‡æ­Œ
- æ˜¾ç¤ºæ’é˜Ÿæ’­æ”¾æ­Œæ›²ï¼Œæ¸²æŸ“è§†é¢‘
- é€šè¿‡å¼¹å¹•è·å–å®æ—¶cpuæ¸©åº¦
- é—²æ—¶éšæœºæ’­æ”¾é¢„ç•™æ­Œæ›²
- æ’­æ”¾éŸ³ä¹æ—¶èƒŒæ™¯å›¾ç‰‡éšæœºé€‰æ‹©
- ~~å¯ç‚¹æ’­bç«™ä»»æ„è§†é¢‘ï¼ˆä¼šå‘˜é™åˆ¶é™¤å¤–ï¼Œç•ªå‰§æ ¹æ®bç«™è§„å®šï¼Œç¦æ­¢ç‚¹æ’­ï¼‰~~ï¼ˆæ¥å£æš‚æ—¶å¤±æ•ˆï¼‰
- å·²ç‚¹æ’­æ­Œæ›²ã€è§†é¢‘è‡ªåŠ¨è¿›å…¥ç¼“å­˜ï¼Œæ— äººç‚¹æ’­æ—¶éšæœºæ’­æ”¾
- å­˜å‚¨ç©ºé—´è¾¾åˆ°è®¾å®šå€¼æ—¶ï¼Œè‡ªåŠ¨æŒ‰ç‚¹æ’­æ—¶é—´é¡ºåºåˆ é™¤éŸ³ä¹ã€è§†é¢‘æ¥é‡Šæ”¾ç©ºé—´
- å®æ—¶æ˜¾ç¤ºæ­Œæ›²/è§†é¢‘é•¿åº¦
- æ ¹æ®æŠ•å–‚ç¤¼ç‰©çš„å¤šå°‘æ¥å†³å®šæ˜¯å¦å…è®¸ç‚¹æ’­

å·²çŸ¥é—®é¢˜ï¼š

- æ¢æ­Œã€è§†é¢‘æ—¶ä¼šé—ªæ–­

## é£Ÿç”¨æ–¹æ³•ï¼š

æˆ‘è¿™é‡Œç”¨çš„æ˜¯æ ‘è“æ´¾3Bï¼Œç³»ç»Ÿ2017-09-07-raspbian-stretch.imgï¼Œå®˜æ–¹é»˜è®¤è½¯ä»¶æºï¼Œå…¶ä»–é…ç½®è¯·è‡ªæµ‹

### å…ˆå‡†å¤‡é¤å…·ï¼š

```Bash
sudo apt-get update
sudo apt-get -y install autoconf automake build-essential libass-dev libfreetype6-dev libtheora-dev libtool libvorbis-dev pkg-config texinfo wget zlib1g-dev
```

å®‰è£…x264ç¼–ç å™¨ï¼ˆæ—¶é—´è¾ƒé•¿ï¼‰ï¼š

```Bash
git clone https://code.videolan.org/videolan/x264.git
cd x264
./configure --host=arm-unknown-linux-gnueabi --enable-static --disable-opencl --enable-shared
make
sudo make install
cd ..
rm -rf x264
```

libmp3lameï¼š

```Bash
sudo apt-get install libmp3lame-dev
```

libopus:

```Bash
sudo apt-get install libopus-dev
```

libvpx:

```Bash
sudo apt-get install libvpx-dev
```

libomxil-bellagio:

```Bash
sudo apt-get install libomxil-bellagio-dev
```

ç¼–è¯‘å¹¶å®‰è£…ffmpegï¼ˆæ—¶é—´è¾ƒé•¿ï¼ŒåŠå°æ—¶å·¦å³ï¼‰ï¼š

```Bash
wget http://ffmpeg.org/releases/ffmpeg-4.0.tar.bz2
tar jxvf ffmpeg-4.0.tar.bz2
cd ffmpeg-4.0
sudo ./configure --arch=armel --target-os=linux --enable-gpl --enable-libx264 --enable-nonfree --enable-libass --enable-libfreetype  --enable-omx --enable-omx-rpi --enable-encoder=h264_omx --enable-mmal --enable-hwaccel=h264_mmal --enable-decoder=h264_mmal
make -j4
sudo make install
cd ..
```

ï¼ˆä»¥ä¸Šæœ‰ä¸€éƒ¨åˆ†ä»£ç å‚è€ƒè‡ª[ffmpegæºç ç¼–è¯‘å®‰è£…ï¼ˆCompile ffmpeg with sourceï¼‰  Part 2 ï¼š æ‰©å±•å®‰è£… - äººè„‘ä¹‹æˆ˜ - åšå®¢å›­](http://www.cnblogs.com/yaoz/p/6944942.html)ï¼‰

å®‰è£…python3ï¼š

```Bash
sudo apt-get install python3
```

å®‰è£…pip3ï¼š

```Bash
sudo apt-get install python3-pip
```

å®‰è£…python3çš„mutagenåº“ï¼š

```Bash
sudo pip3 install mutagen
```

å®‰è£…python3çš„you-getåº“ï¼š

```Bash
sudo pip3 install you-get
```

å®‰è£…python3çš„moviepyåº“ï¼š

```Bash
sudo pip3 install moviepy
```

å®‰è£…python3çš„aiohttpåº“ï¼š

```Bash
sudo pip3 install aiohttp
```

å®‰è£…python3çš„numpyéœ€è¦çš„åº“ï¼š

```Bash
sudo apt-get install libatlas-base-dev
```

å®‰è£…python3çš„requestsåº“ï¼š

```Bash
sudo pip3 install requests
```

å®‰è£…screen:

```Bash
sudo apt-get install screen
```

å®‰è£…ä¸­æ–‡å­—ä½“

```Bash
sudo apt install fontconfig
sudo apt-get install ttf-mscorefonts-installer
sudo apt-get install -y --force-yes --no-install-recommends fonts-wqy-microhei
sudo apt-get install -y --force-yes --no-install-recommends ttf-wqy-zenhei
#å¯èƒ½æœ‰è£…ä¸ä¸Šçš„ï¼Œåº”è¯¥é—®é¢˜ä¸å¤§

# æŸ¥çœ‹ä¸­æ–‡å­—ä½“ --ç¡®è®¤å­—ä½“æ˜¯å¦å®‰è£…æˆåŠŸ
fc-list :lang=zh-cn
```

ï¼ˆå­—ä½“å®‰è£…æ¥è‡ª[ubuntuä¸‹ bilibiliç›´æ’­æ¨æµ ffmpeg rtmpæ¨é€](https://ppx.ink/2.ppx)ï¼‰

### è®¾ç½®æ˜¾å­˜

æ‰“å¼€æ ‘è“æ´¾è®¾ç½®ï¼š

```Bash
sudo raspi-config
```

é€‰æ‹©`Advanced Options`ï¼Œå›è½¦

é€‰æ‹©`Memory Split`ï¼Œå›è½¦

æŠŠæ•°å€¼æ”¹æˆ`256`

å›è½¦ï¼Œæ¥ç€é€€å‡ºè®¾ç½®ï¼Œé‡å¯æ ‘è“æ´¾

### çƒ¹é¥ª&æ‘†ç›˜ï¼š

ä¸‹è½½æœ¬é¡¹ç›®ï¼š

```Bash
git clone https://github.com/chenxuuu/24h-raspberry-live-on-bilibili.git
```

æˆ–

```Bash
git clone https://gitee.com/Young_For_You/24h-raspberry-live-on-bilibili.git
```

è¯·ä¿®æ”¹ä¸‹è½½é‡Œçš„`var_set.py`æ–‡ä»¶ä¸­çš„å„ç§å˜é‡
å…¶ä¸­ï¼Œ`cookie`éœ€è¦ä½¿ç”¨å°å·ï¼ˆå°½é‡ä½¿ç”¨å°å·ï¼Œå¹¶ä¸”bç«™è´¦æˆ·å¥½åƒéœ€è¦ç»‘å®šæ‰‹æœºå·åæ‰èƒ½å‘é€å¼¹å¹•ï¼‰åœ¨ç›´æ’­é—´ï¼Œæ‰“å¼€æµè§ˆå™¨å®¡æŸ¥å…ƒç´ ï¼Œå…ˆå‘ä¸€æ¡å¼¹å¹•ï¼Œå†æŸ¥çœ‹`network`é€‰é¡¹å¡ï¼Œæ‰¾åˆ°`name`ä¸º`send`çš„é¡¹ç›®ï¼Œ`Form data`ä¸­çš„`csrf_token`å³ä¸º`csrf_token`å˜é‡çš„å€¼ã€‚æ³¨æ„è®¾ç½®åï¼Œè´¦å·ä¸èƒ½ç‚¹å‡»ç½‘é¡µä¸Šçš„â€œé€€å‡ºç™»é™†â€æŒ‰é”®ï¼Œæ¢è´¦å·è¯·ç›´æ¥æ¸…é™¤å½“å‰cookieå†åˆ·æ–°

æ¥ç€ï¼Œç‚¹å‡»`æ§åˆ¶å°`(`console`)ï¼Œè¾“å…¥`document.cookie`ç„¶åå›è½¦ï¼Œè¿”å›å€¼å³ä¸º`cookie`å˜é‡çš„å€¼ã€‚

`csrf_token`è¯·å¡«å†™`Request head`ä¸­çš„`csrf_token`

`post_dm.py`æ–‡ä»¶çš„`if(user == 'æ¥å¾…å–µ'):  #é˜²æ­¢è‡ªå¾ªç¯`è¯·æ”¹ä¸ºä½ çš„æœºå™¨äººçš„åå­—

æ ‡æ³¨`#debugä½¿ç”¨ï¼Œè¯·è‡ªå·±ä¿®æ”¹`çš„ä»£ç è¯·è‡ªè¡Œä¿®æ”¹ï¼Œæ­¤ä¸ºdebugç”¨çš„ä»£ç 

å¦‚æœ‰æ¡ä»¶ï¼Œè¯·`åŠ¡å¿…`è‡ªå·±æ­å»ºphpçš„ä¸‹è½½é“¾æ¥è§£ææœåŠ¡ï¼Œæºç éƒ½åœ¨`php`æ–‡ä»¶å¤¹å†…

`default_mp3`æ–‡ä»¶å¤¹å†…æ”¾å…¥mp3æ ¼å¼çš„éŸ³ä¹ï¼Œåœ¨æ— äººç‚¹æ­Œæ—¶æ’­æ”¾ï¼Œè¯·å°½é‡ä¿è¯æ–‡ä»¶åå…¨è‹±æ–‡ï¼ˆå¯è¦å¯ä¸è¦ï¼Œå› ä¸ºç°åœ¨å·²ç»æ”¹ä¸ºæ”¾ç‚¹æ’­è¿‡çš„ç¼“å­˜æ­Œæ›²ã€è§†é¢‘äº†ï¼‰

`default_pic`æ–‡ä»¶å¤¹å†…æ”¾å…¥jpgæ ¼å¼çš„å›¾ç‰‡ï¼Œç”¨äºåšä¸ºæ”¾éŸ³ä¹æ—¶çš„èƒŒæ™¯ï¼Œè¯·å°½é‡ä¿è¯æ–‡ä»¶åå…¨è‹±æ–‡ï¼Œåˆ†è¾¨ç‡æ¨èç»Ÿä¸€å¤„ç†ä¸º1280x720

æ‰€æœ‰é…ç½®å®Œæˆåï¼Œå¼€å¯ç›´æ’­ï¼Œç„¶åå¯åŠ¨è„šæœ¬å³å¯ï¼š

```Bash
screen python3 play.py
#æŒ‰ctrl+a,æŒ‰ctrl+d
screen python3 bilibiliClient.py
#æŒ‰ctrl+a,æŒ‰ctrl+d
#å¼¹å¹•ç›‘æ§ä½¿ç”¨äº†å¼¹å¹•å§¬pythonç‰ˆï¼šhttps://github.com/lyyyuna/bilibili_danmu
#æ„Ÿè°¢å¼¹å¹•å§¬pythonç‰ˆä½œè€…çš„åˆ†äº«
```

å¦‚æœ‰ä¸å¯¹çš„åœ°æ–¹ï¼Œè¯·æäº¤issueï¼Œä¹Ÿæ¬¢è¿å„ä½æ”¹è¿›è„šæœ¬å¹¶pr

æœ¬ç¨‹åºåè®®ä¸ºGPL

## Contributors âœ¨

Thanks goes to these wonderful people ([emoji key](https://allcontributors.org/docs/en/emoji-key)):

<!-- ALL-CONTRIBUTORS-LIST:START - Do not remove or modify this section -->
<!-- prettier-ignore -->
<table>
  <tr>
    <td align="center"><a href="https://github.com/madokaa"><img src="https://avatars3.githubusercontent.com/u/16538800?v=4" width="100px;" alt="madoka"/><br /><sub><b>madoka</b></sub></a><br /><a href="https://github.com/chenxuuu/24h-raspberry-live-on-bilibili/commits?author=madokaa" title="Code">ğŸ’»</a> <a href="https://github.com/chenxuuu/24h-raspberry-live-on-bilibili/issues?q=author%3Amadokaa" title="Bug reports">ğŸ›</a></td>
    <td align="center"><a href="https://github.com/Lvmoo"><img src="https://avatars3.githubusercontent.com/u/20103297?v=4" width="100px;" alt="Lvmoo"/><br /><sub><b>Lvmoo</b></sub></a><br /><a href="https://github.com/chenxuuu/24h-raspberry-live-on-bilibili/commits?author=Lvmoo" title="Code">ğŸ’»</a> <a href="https://github.com/chenxuuu/24h-raspberry-live-on-bilibili/issues?q=author%3ALvmoo" title="Bug reports">ğŸ›</a></td>
    <td align="center"><a href="https://github.com/shilela"><img src="https://avatars3.githubusercontent.com/u/31099477?v=4" width="100px;" alt="æ¡£100"/><br /><sub><b>æ¡£100</b></sub></a><br /><a href="https://github.com/chenxuuu/24h-raspberry-live-on-bilibili/commits?author=shilela" title="Code">ğŸ’»</a> <a href="https://github.com/chenxuuu/24h-raspberry-live-on-bilibili/issues?q=author%3Ashilela" title="Bug reports">ğŸ›</a></td>
    <td align="center"><a href="https://github.com/luojiaquan7737"><img src="https://avatars0.githubusercontent.com/u/25074701?v=4" width="100px;" alt="luojiaquan0320"/><br /><sub><b>luojiaquan0320</b></sub></a><br /><a href="https://github.com/chenxuuu/24h-raspberry-live-on-bilibili/issues?q=author%3Aluojiaquan7737" title="Bug reports">ğŸ›</a></td>
    <td align="center"><a href="http://hanximeng.com"><img src="https://avatars1.githubusercontent.com/u/28382753?v=4" width="100px;" alt="å¯’æ›¦æœ¦"/><br /><sub><b>å¯’æ›¦æœ¦</b></sub></a><br /><a href="#ideas-hanximeng" title="Ideas, Planning, & Feedback">ğŸ¤”</a></td>
    <td align="center"><a href="https://github.com/XuewanZhao"><img src="https://avatars2.githubusercontent.com/u/33767163?v=4" width="100px;" alt="Xuewan"/><br /><sub><b>Xuewan</b></sub></a><br /><a href="#ideas-XuewanZhao" title="Ideas, Planning, & Feedback">ğŸ¤”</a></td>
    <td align="center"><a href="https://github.com/a08381"><img src="https://avatars2.githubusercontent.com/u/2505002?v=4" width="100px;" alt="a08381"/><br /><sub><b>a08381</b></sub></a><br /><a href="#ideas-a08381" title="Ideas, Planning, & Feedback">ğŸ¤”</a></td>
  </tr>
</table>

<!-- ALL-CONTRIBUTORS-LIST:END -->

This project follows the [all-contributors](https://github.com/all-contributors/all-contributors) specification. Contributions of any kind welcome!
